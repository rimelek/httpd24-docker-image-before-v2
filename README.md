# README

**!!! IMPORTANT !!!:** The new repository is https://github.com/rimelek/httpd24-docker-image

Years ago I made a mistake and pushed the repository in a new namespace instead of using GitHub's "transfer" feature so I had two repository with common history. Now I decided to move the project back to the old namespace "rimelek". Since both of the repositories have followers, stars or forks, I keep this repository too, but I recommend everyone to use the new one linked above.

----

You may want to use this HTTPD 2.4 if you 
 
- need to quickly run a webserver with PHP-FPM
- easily turn SSL on/off
- easily turn HTTP Basic authentication on/off
- use a reverse proxy without changing the client IP
- reconfigure the following directives without a custom configuration file:
  - DocumentRoot
  - ServerName
  - ServerAdmin
  
Set the the following environment variables as you need:

- **SRV_NAME**: (default: localhost.localdomain) This will change the default ServerName
- **SRV_ADMIN**: (default: webmaster@localhost) This variable is for ServerAdmin
- **SRV_DOCROOT**: (default: /usr/local/apache2/htdocs) DocumentRoot can be configured by setting this variable.
- **SRV_REVERSE_PROXY_DOMAIN**: (default: "") It can contain the IP address or hostname of the reverse proxy server. It is important if you want to see the real IP addresses of clients when you use a reverse proxy.
- **SRV_REVERSE_PROXY_CLIENT_IP_HEADER**: (default: X-Forwarded-For) The name of the header which contains the real IP address. It is ignored when SRV_REVERSE_PROXY_DOMAIN is not given.
- **SRV_SSL**: (default: 0) Set this variable to 1 if you want HTTPD to listen on port 443 and use SSL certifications. In this case you have to mount your private key file and the certificate (full chain) to the container. Here is where HTTPD search for these files:
  - SSLCertificateFile /usr/local/apache2/ssl.crt
  - SSLCertificateKeyFile /usr/local/apache2/ssl.key
- **SRV_AUTH**: (default: 0) Set this to 1 if you need HTTP Basic authentication using an htpasswd file. Mount password file inside the container at /usr/local/apache2/.htpasswd \
- **SRV_PHP**: (default: 0) If you need PHP-FPM, set it to 1. In this case HTTPD will use "php" as hostname to connect to the FPM service on port 9000. You can customize using following variables \
  - **SRV_PHP_HOST**: (default: php) The hostname of the PHP-FPM service.
  - **SRV_PHP_PORT**: (default: 9000) The port number of the PHP-FPM service.
  
## Examples

### Using SSL certification generated by Let's Encrypt

```bash
docker run -d \
   -env SRV_SSL=1 \
   -v /etc/letsencrypt/yourcertname/privkey.pem:/usr/local/apache2/ssl.key \
   -v /etc/letsencrypt/yourcertname/fullchain.pem:/usr/local/apache2/ssl.crt \
   -p 443:443 \
   itsziget/httpd24
```

### HTTP Authentication

```bash
docker run --rm -i itsziget/httpd24 /bin/bash -c "htpasswd -nb YOURUSERNAME YOURPASSWORD" >> .htpasswd
docker run -d \
   -v `pwd`/.htpasswd:/usr/local/apache2/.htpasswd \
   -p 80:80 \
   itsziget/httpd24
```

### Simplest way to use PHP-FPM

**Legacy way:**

```bash
mkdir -p src
echo "<?php phpinfo(); " > src/index.php
docker run -d \
   -v $PWD/src:/usr/local/apache2/htdocs \
   --name php \
   php:7.1-fpm
docker run -d \
   --volumes-from php \
   --env SRV_PHP=1 \
   -p "80:80" \
   --link php \
   itsziget/httpd24
   
```

**Recommended way:**

```bash
mkdir -p src
echo "<?php phpinfo(); " > src/index.php
docker network create phptest
docker run -d \
   -v $PWD/src:/usr/local/apache2/htdocs \
   --name php \
   --network phptest \
   php:7.1-fpm
docker run -d \
   --volumes-from php \
   --env SRV_PHP=1 \
   -p "80:80" \
   --network phptest \
   itsziget/httpd24
   
```

**Reusing the network of the HTTPD container**

```bash
mkdir -p src
echo "<?php phpinfo(); " > src/index.php
docker run -d \
   -v $PWD/src:/usr/local/apache2/htdocs \
   --name php \
   -p "80:80" \
   php:7.1-fpm
docker run -d \
   --volumes-from php \
   --env SRV_PHP=1 \
   --env SRV_PHP_HOST=localhost \
   --network container:php \
   itsziget/httpd24
   
```

**Tip:** If you need PHP with more modules than the official version built with, use my version: [https://hub.docker.com/r/itsziget/php/](https://hub.docker.com/r/itsziget/php/)
